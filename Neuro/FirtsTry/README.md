Код ужасен, сильно не бейте, я учусь(и не особо следил за кодом та как разбирался).
Скорее всего не работает в большинстве случаев но в парочке нормально.
